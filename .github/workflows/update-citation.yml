name: Update CITATION.cff

on:
  release:
    types: [published]
  workflow_dispatch:

jobs:
  update-citation:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install cffconvert
        run: pip install cffconvert

      - name: Update CITATION.cff
        run: |
          # Get the latest release version and remove 'version' prefix if present
          VERSION=$(echo ${{ github.event.release.tag_name }} | sed 's/^version//')
          
          # Update version and date in CITATION.cff
          sed -i "s/version: .*/version: $VERSION/" CITATION.cff
          sed -i "s/date-released: .*/date-released: $(date +%Y-%m-%d)/" CITATION.cff
          
          # Validate the updated file
          cffconvert --validate

      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add CITATION.cff
          git commit -m "Update CITATION.cff for version ${{ github.event.release.tag_name }}"
          git push 